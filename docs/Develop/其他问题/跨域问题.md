# 前后端连接的跨域问题

> 偶然在一次部署自己的vue和django项目时遇到的问题。
>
> 已经为django配置跨域请求之后，部署到服务器上依然无法连接后端。

## 问题描述

> 假设内网ip为 10.20.66.123 , 外网ip为 101.123.456.789

### 1.在笔者电脑上（成功）

- 前端启动地址为`10.20.66.123:3200`，后端启动地址为`10.20.66.123:8000`
- 前端请求后端地址为`10.20.66.123:8000`
- 请求方式:  本机浏览器
- 结果：正常请求

### 2.云服务器上（成功）

- 前端启动地址为`10.20.66.123:3200`，后端启动地址为`10.20.66.123:8000`
- 前端请求后端地址为`10.20.66.123:8000`
- 请求方式: 云服务器内部浏览器
- 结果: 正常请求

### 3.云服务器上(失败)

- 前端启动地址为`10.20.66.123:3200`，后端启动地址为`10.20.66.123:8000`
- 前端请求后端地址为`10.20.66.123:8000`
- 请求方式： 笔者通过外部ip访问`101.123.456.789：3200`，也就是前端页面
- 结果：
    - 请求前端页面成功
    - 但是通过前端页面请求后端失败，通过`F12`调试可以看到，禁止来自'10.20.66.123:8000'的内容，拦截跨域请求

## 解决

在这里因为不是很熟悉云服务器的NAT转发，所以一度非常迷惑，不知道问题在哪里。

然后转化了一下思路，如果将后端放在笔者电脑上，从云服务器请求笔者电脑ip+端口，应该是可行的。

顺着这个思路，如果将同一服务器上的两个项目彼此当成陌生人，互相都只请求对方的外网ip，而不是内网ip，应该是可以的。

一试便知，成功请求

- 前端启动地址为`10.20.66.123:3200`，后端启动地址为`10.20.66.123:8000`
- 前端请求后端地址为`101.123.456.789:8000`，此时这里为外网ip
- 请求方式：外部浏览器访问`101.123.456.789：3200`
- 结果：成功运行


## 思考

后续了解了一下NAT转发，云服务器的外网ip，其实就是他的内网ip，只不过为了安全，服务器内部只能使用内网ip

虽然看着不同，但是从外部访问外网ip，就相当于在内部访问内网ip，服务器会自动将外网请求转为内网请求

因此从外部访问，请求外部ip即可。







