# 电子取证

[toc]



## 一、文件系统认识

### 1.从MBR到DBR到FSinfo

- 进入软件之后所处的0位置就是MBR，切换成十进制，然后偏移量移动128，就到了DBR

- 此时DBR的开头一般是 EB 58，下一个扇区就是FSinfo
- FSinfo一般是 52 52开头，右侧可看到RRaA的标识

### 2.备份区

- 从fsinfo往下3到4个扇区，会再次看到 EB 58，就是DBR的备份扇区，再往下就是FSifno的备份是扇区。

### 3.从DBR到FAT表

- 切换到16进制，找到 0E(第一行)，可能是`2E`，然后看数据解释器，提取16bit的值，再切换到10进制，从当前位置跳转，就到了FAT表。

### 4.判断空余簇的数量

- 来到FSinfo扇区的最后倒数两行，1E8到1EB是第一个可用簇，1EC-1EF是下一个，一般根目录在2号簇



## 二、FAT32介绍

### 1.短文件名目录项

文件命名的传统格式，`8.3`格式，主文件名不超过八个字符

`E5`开头，表示删除的文件，在E5那行可以看右边解释，就有文件名。

短文件名目录占两行，0B是文件名

#### 1.1删除文件夹/文件

- 先打开winhex，点击上面的分区，进入后再点击根目录，即可查看根目录下有哪些文件。
- 然后创建一个文件夹，如果文件夹名字过长，则会展示为类似`1111~`这样的形式，这是文件夹位置的第一行。
- 删除文件夹，再次快照，会发现`1111~`这种注释的最左边第一个位置变成了E5，表示删除了文件夹。
- 文件同理。

#### 1.2分析

这里的00的第一个0，是指在winhex里面的两行，然后第一行就是0，第二行就是1，所以00-0A是指，第一行的0到第一行的A。

```markdown
短文件名目录项占两行，其含义：00-0A：文件名；0B：文件属性（00：读/写；01：只读；02：隐藏：40：系统；08：卷标；10：子目录；20：存档）；0C：保留；0D：创建时间毫秒；0E-0F：创建时间；10-13：最后访问时间；16-19：最后修改时间；14-15+1A-1B：起始簇（其中14-15为高16位，1A-1B为低16位）；1C-1F：文件大小字节数。
```

#### 1.3单簇恢复文件

现在分析起始簇，看当前字节的16bit

总的簇数=`14-15*65536+1A-1B` 的数量

注意！看簇数是**点一下**14或者1A，不是选中**全部**。

- 假设`14-15`的16bit是6，`1A-1B`的16bit是7，那跳转的总簇数就是 `6*65536+7`
- 然后恢复文件就是跳转过去，选中头部，再选中尾部，然后`编辑`，`复制选快`,`至新文件`就行。

#### 1.4多簇恢复文件

> 当一个目录的文件比较多时，一个簇无法存放所有的文件项，**FAT32**文件系统会不断增加簇用以存放，由于增加的簇可能是不连续的，所以需要通过**FAT表**来确定指定目录的下一簇的簇号。

- 进入MBR-DBR，然后查找十六进制值`F8FFFF0F`,就能到达FAT表。

**查看2号簇**

- 2号簇就是类似`D72E0000`这样的字段，起始位是0号簇（0，1，2），或者说`08 - 0B`这个位置
- 如果2号簇为`FFFFFF0F`，则代表着2号簇足够装下磁盘里的所有东西。
- 如果类似现在这样2号簇为`D72E0000`,3号簇为`FFFFFF0F`，则代表着2号簇没装下，3号簇装下了剩余的东西。

```markdown
F8FFFF0F FFFFFFFF D72E0000 FFFFFF0F
FFFFFF0F FFFFFF0F FFFFFF0F FFFFFF0F
```

**从2号簇跳转到3号簇**

- 将鼠标放在`08`位置，观看 32bit 的值，这就是跳转的簇数，注意是跳转簇，即可到3号簇



## 三、创建磁盘镜像

### 1.长文件名目录项

这是一个名为`nishiwodewoshinideshui.txt`的长名字文件，下面是它的16进制值。

现在开始分析：

- 首先将下列值分为三段
- 最下面`4E`开头两行为文件名，它上面的两行就是长文件名的拓展部分。
- 首先开第一行开头的`42`，4表示了文件名称的技术，2表示文件拓展名占用了两行。
- 接下来看第三行开头的`01`，它表示文件拓展名的第一行。

举例：

- 如果某个文件名第一行是`45`，那表示它的文件拓展名占用了5行。
- 且`从下到上`，每两行的开头分别是`01`,`02`,`03`,`04`,`45`。

<img src="D:\zzz\school\大三下\电子取证\image-20240403112328931.png" alt="image-20240403112328931" style="zoom:60%;" />



### 2.创建镜像

- 创建一个盘
- 打开磁盘
- ctrl +a ，复制选择到新文件。此时会打开一个新窗口，然后选择`专业工具`，将新窗口转为磁盘。

### 3.进行操作

- 接下来在老盘创建一个文件，写入一部分内容，即使是创建一个新文件也可以
- 然后进行比对：选择`工具`，再将两个磁盘进行比对（注意选择的磁盘类型相同）

### 4.跳转

- 首先点击 查看 ，分别点击 同步，同步窗口
- 复制导出的报告文件，复制值，将跳转的单位改为`bytes`，进行跳转即可。







